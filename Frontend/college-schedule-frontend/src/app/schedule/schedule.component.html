<div class="schedule-container">
  <!-- Шапка с датой и кнопками -->
  <div class="header">
    <div class="header-top">
      <div>
        <div class="greeting">Доброе утро, {{telegramService.getUserName() || 'Студент'}}!</div>
        <div class="current-date">{{currentDate}}</div>
        <div class="week-info">{{weekInfo}}</div>
      </div>
      <div>
        <button class="icon-btn" (click)="toggleAI()">
          <i class="fas fa-robot"></i>
        </button>
        <button class="icon-btn" style="margin-left: 10px;" (click)="openProfile()">
          <i class="fas fa-user"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Статистика -->
  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-value">{{lectureCount}}</div>
      <div class="stat-label">Пары сегодня</div>
    </div>
    <div class="stat-item">
      <div class="stat-value">{{activityCount}}</div>
      <div class="stat-label">Мероприятия</div>
    </div>
    <div class="stat-item">
      <div class="stat-value">{{nextTime}}</div>
      <div class="stat-label">До следующего</div>
    </div>
  </div>

  <!-- Фильтры -->
  <div class="quick-access">
    <div class="section-title">
      <span><i class="far fa-calendar-alt"></i> Расписание на сегодня</span>
    </div>
    <div class="filter-tabs">
      <div class="filter-tab" [class.active]="activeFilter === 'all'" (click)="filterEvents('all')">
        <i class="fas fa-layer-group"></i> Все
      </div>
      <div class="filter-tab" [class.active]="activeFilter === 'study'" (click)="filterEvents('study')">
        <i class="fas fa-graduation-cap"></i> Учёба
      </div>
      <div class="filter-tab" [class.active]="activeFilter === 'extra'" (click)="filterEvents('extra')">
        <i class="fas fa-star"></i> Внеурочное
      </div>
    </div>
  </div>

  <!-- Список событий -->
  <div class="event-list">
    <div *ngFor="let item of filteredItems" 
         class="event-card" 
         [class.current]="item.isCurrent"
         [class.extra]="item.type === 'extra' || item.type === 'activity'">
      
      <div class="event-type" [ngClass]="getEventTypeClass(item.type)">
        {{getEventTypeText(item.type)}}
        <span *ngIf="item.isCurrent"> • Сейчас</span>
      </div>
      
      <div class="event-time">
        <i class="far fa-clock"></i> 
        {{formatTime(item.startTime)}} – {{formatTime(item.endTime)}}
        <span *ngIf="item.isCurrent" style="margin-left:15px;color:#ef4444;">
          • Осталось 25 мин
        </span>
      </div>
      
      <div class="event-name">{{item.subject}}</div>
      
      <div class="event-details">
        <span *ngIf="item.room">
          <i class="fas fa-door-open"></i> {{item.room}}
        </span>
        <span *ngIf="item.teacher">
          <i class="fas fa-chalkboard-teacher"></i> {{item.teacher}}
        </span>
        <span *ngIf="item.groupName">
          <i class="fas fa-users"></i> {{item.groupName}}
        </span>
      </div>
      
      <div class="event-tags">
        <div *ngIf="item.isCurrent" class="tag important">Текущая</div>
        <div class="tag">{{item.subject?.split(' ')[0]}}</div>
        <div *ngIf="item.type === 'lecture'" class="tag online">Можно онлайн</div>
      </div>
    </div>
    
    <!-- Сообщение если нет событий -->
    <div *ngIf="filteredItems.length === 0" class="empty-state">
      <i class="fas fa-calendar-times fa-3x"></i>
      <h4>Нет событий на сегодня</h4>
      <p>Отдыхайте или добавьте свои мероприятия!</p>
    </div>
  </div>

  <!-- Плавающая кнопка ИИ -->
  <div class="ai-float">
    <button class="ai-btn pulsing" (click)="toggleAI()">
      <i class="fas fa-robot"></i>
    </button>
  </div>

  <!-- Плавающая кнопка добавления -->
  <div class="fab-container">
    <button class="fab" (click)="openAddModal()">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <!-- Модальное окно добавления события -->
  <div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">Новое событие</div>
        <button class="modal-close" (click)="closeAddModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Тип события</label>
          <div class="type-selector">
            <div class="type-option" 
                 [class.active]="newEvent.type === 'lecture'"
                 (click)="selectEventType('lecture')">
              <i class="fas fa-graduation-cap"></i><br>Лекция
            </div>
            <div class="type-option" 
                 [class.active]="newEvent.type === 'practice'"
                 (click)="selectEventType('practice')">
              <i class="fas fa-laptop-code"></i><br>Практика
            </div>
            <div class="type-option" 
                 [class.active]="newEvent.type === 'extra'"
                 (click)="selectEventType('extra')">
              <i class="fas fa-star"></i><br>Доп. занятие
            </div>
            <div class="type-option" 
                 [class.active]="newEvent.type === 'activity'"
                 (click)="selectEventType('activity')">
              <i class="fas fa-users"></i><br>Мероприятие
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Название *</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="newEvent.subject"
                 placeholder="Например: Подготовка к экзамену">
        </div>
        <div class="form-group">
          <label class="form-label">Дата и время *</label>
          <input type="datetime-local" class="form-control" 
                 [(ngModel)]="newEvent.startTime">
        </div>
        <div class="form-group">
          <label class="form-label">Место</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="newEvent.room"
                 placeholder="Аудитория или онлайн">
        </div>
        <div class="form-group">
          <label class="form-label">Преподаватель</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="newEvent.teacher"
                 placeholder="ФИО преподавателя">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeAddModal()">Отмена</button>
        <button class="btn btn-primary" (click)="addNewEvent()">Добавить</button>
      </div>
    </div>
  </div>
</div>